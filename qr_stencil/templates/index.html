<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QR Stencil Creator</title>
  {{plausible_tag}}
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;

      margin: 0;
      padding: 20px;
      box-sizing: border-box;
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
    }

    p {
      color: #555;
      background-color: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      max-width: 400px;
      text-align: center;
      margin-bottom: 20px;
    }

    form {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
      width: 100%;
      max-width: 400px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #555;
    }

    input[type="text"],
    input[type="number"],
    select {
      width: calc(100% - 22px);
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    button {
      background-color: #007BFF;
      color: #fff;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      width: 100%;
      max-width: 400px;
    }

    button:hover {
      background-color: #0056b3;
    }

    #imageContainer {
      text-align: center;
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      width: 80%;
      max-width: 400px;
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    #resultImage {
      max-width: 100%;
      height: auto;
      display: none;
      margin: auto;
    }

    .largeImage {
      width: 100%;
      height: auto;
    }

    #saveButton {
      display: none;
      margin-top: 20px;
      background-color: #28a745;
      color: #fff;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      width: 100%;
      max-width: 400px;
    }

    #saveButton:hover {
      background-color: #218838;
    }

    #qrDetails {
      display: none;
      margin-top: 10px;
      color: #555;
      background-color: #f9f9f9;
      padding: 10px;
      border-radius: 4px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
    }

    #qrDetails table {
      width: 100%;
      border-collapse: collapse;
    }

    #qrDetails td {
      padding: 5px;
      border-bottom: 1px solid #ddd;
    }

    #qrDetails td:last-child {
      text-align: right;
    }

    .help-icon {
      cursor: pointer;
      margin-left: 5px;
      color: #007BFF;
    }

    .help-popup {
      display: none;
      position: absolute;
      background-color: #fff;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 4px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      max-width: 300px;
    }

    .inline-label {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .inline-label label {
      margin-right: 10px;
      margin-bottom: 0;
    }

    .inline-label input[type="number"],
    .inline-label select,
    .inline-label input[type="checkbox"],
    .inline-label input[type="color"] {
      width: auto;
      flex: 1;
    }
  </style>
</head>

<body>
  <h1>QR Stencil Creator</h1>

  <p>This tool allows you to generate QR Codes as SVG files that can be cut out with electronic
    cutters or laser printers to create stencils or engravings. Simply enter the text you want to encode, and click
    <i>Generate Image</i> to see your QR Code. You can then save the generated image to your computer to import
    into your laser cutter.
  </p>

  <form id="textForm">

    <label for="textInput" id="textInputLabel">QR Content ℹ️:</label>
    <input type="text" id="textInput" name="msg" placeholder="" required>
    <div class="help-popup" id="textInputHelpPopup">
      This is the text that will be embedded in the QRCode. The most common use case is to embed a URL.
    </div>

    <div class="inline-label">
      <label for="errorLevel" id="errorLevelLabel">Allowed Error Level ℹ️:</label>
      <select id="errorLevel" name="error_level" required>
        <option value="7">7</option>
        <option value="15" selected>15</option>
        <option value="25">25</option>
        <option value="30">30</option>
      </select>
    </div>
    <div class="help-popup" id="errorLevelHelpPopup">
      The higher this is the more damaged the QR code can be and still work, at the expense of requiring more data and a
      denser QR code. For smaller stencils you may want to use a lower number. If you use the higher error numbers you
      can
      engrave an image into the center of the QR code and it will still work.
    </div>

    <div class="inline-label">
      <label for="sizeRatio" id="sizeRatioLabel">Grid Percentage Fill ℹ️:</label>
      <input type="number" id="sizeRatio" name="size_ratio" value="80" step="1" min="1" max="100" required>
    </div>
    <div class="help-popup" id="sizeRatioHelpPopup">
      The smaller this is the more space between blocks. This will increase the error level but create more physically
      stable stencils. You want to use the highest number (and least space between blocks) allows your cutter to create
      the stencil you want.
    </div>

    <div class="inline-label">
      <label for="stencil" id="stencilLabel">Include Stencil Cut Lines ℹ️:</label>
      <input type="checkbox" id="stencil" name="stencil" checked>
    </div>
    <div class="help-popup" id="stencilHelpPopup">
      Check this box if you want the QR code to include stencil cut lines for the QR Code "eyes".
      This should be enabled for stencils but disabled for engravings
    </div>

    <div class="inline-label">
      <label for="style" id="styleLabel">QR Style ℹ️:</label>
      <select id="style" name="style" required>
        <option value="square" selected>Square</option>
        <option value="circle">Circle</option>
      </select>
    </div>
    <div class="help-popup" id="styleHelpPopup">
      Choose the style of the QR code. "Square" is the default style, while "Circle" will create a QR code with circular
      modules.
    </div>

    <div class="inline-label">
      <label for="color" id="colorLabel">QR Color ℹ️:</label>
      <input type="color" id="color" name="color" value="#000000" required>
    </div>
    <div class="help-popup" id="colorHelpPopup">
      Choose the color of the QR code. The default color is black.
    </div>

    <button type="submit">Generate Image</button>

  </form>

  <div id="imageContainer">
    <img id="resultImage" src="" alt="Generated Image" class="largeImage" style="display: block;">
    <div id="qrDetails" style="display: block;">
      <table>
        <tr>
          <td>QR Content:</td>
          <td id="qrText">Enter your text here</td>
        </tr>
        <tr>
          <td>Allowed Error Level:</td>
          <td id="qrErrorLevel">15%</td>
        </tr>
        <tr>
          <td>Grid Percentage Fill:</td>
          <td id="qrSizeRatio">80%</td>
        </tr>
        <tr>
          <td>Stencil Cut Lines:</td>
          <td id="qrStencil">Yes</td>
        </tr>
        <tr>
          <td>QR Style:</td>
          <td id="qrStyle">Square</td>
        </tr>
        <tr>
          <td>QR Color:</td>
          <td id="qrColor">#000000</td>
        </tr>
      </table>
    </div>
    <button id="saveButton" style="display: block;">Save Image</button>
  </div>

  <div>
    <p>Did you find this project useful? Let me know on <a href="https://bsky.app/profile/tedivm.com">BlueSky!</a></p>
  </div>

  <footer>
    <p>This was built by <a href="https://blog.tedivm.com" target="_blank">Robert Hafner</a>. You can find this project
      on <a href="https://github.com/tedivm/qr_stencil_creator" target="_blank">Github</a>.</p>
  </footer>

  <script>
    // DOM element cache
    const elements = {
      textForm: document.getElementById('textForm'),
      textInput: document.getElementById('textInput'),
      errorLevel: document.getElementById('errorLevel'),
      sizeRatio: document.getElementById('sizeRatio'),
      stencil: document.getElementById('stencil'),
      style: document.getElementById('style'),
      color: document.getElementById('color'),
      resultImage: document.getElementById('resultImage'),
      saveButton: document.getElementById('saveButton'),
      qrDetails: document.getElementById('qrDetails'),
      qrText: document.getElementById('qrText'),
      qrErrorLevel: document.getElementById('qrErrorLevel'),
      qrSizeRatio: document.getElementById('qrSizeRatio'),
      qrStencil: document.getElementById('qrStencil'),
      qrStyle: document.getElementById('qrStyle'),
      qrColor: document.getElementById('qrColor')
    };

    // Helper functions
    function buildImageUrl(formData) {
      const params = new URLSearchParams({
        msg: formData.textInput,
        error_level: formData.errorLevel,
        size_ratio: formData.sizeRatio / 100,
        stencil: formData.stencil,
        style: formData.style,
        color: formData.color
      });
      return `/image.svg?${params.toString()}`;
    }

    function getFormData() {
      return {
        textInput: elements.textInput.value,
        errorLevel: elements.errorLevel.value,
        sizeRatio: elements.sizeRatio.value,
        stencil: elements.stencil.checked ? 'true' : 'false',
        style: elements.style.value,
        color: elements.color.value
      };
    }

    function updateQRDetails(formData) {
      elements.qrText.textContent = formData.textInput;
      elements.qrErrorLevel.textContent = `${formData.errorLevel}%`;
      elements.qrSizeRatio.textContent = `${formData.sizeRatio}%`;
      elements.qrStencil.textContent = formData.stencil === 'true' ? 'Yes' : 'No';
      elements.qrStyle.textContent = formData.style.charAt(0).toUpperCase() + formData.style.slice(1);
      elements.qrColor.textContent = formData.color;
    }

    function showResults() {
      elements.resultImage.style.display = 'block';
      elements.resultImage.classList.add('largeImage');
      elements.saveButton.style.display = 'block';
      elements.qrDetails.style.display = 'block';
    }

    // Event handlers
    function handleFormSubmit(event) {
      event.preventDefault();
      const formData = getFormData();
      const imageUrl = buildImageUrl(formData);
      
      elements.resultImage.src = imageUrl;
      showResults();
      updateQRDetails(formData);
    }

    function handleSaveButtonClick() {
      const link = document.createElement('a');
      link.href = elements.resultImage.src;
      link.download = 'qr_code.svg';
      link.click();
    }

    function addPopupEvents(labelId, popupId) {
      const label = document.getElementById(labelId);
      const popup = document.getElementById(popupId);
      
      label.addEventListener('mouseover', () => popup.style.display = 'block');
      label.addEventListener('mouseout', () => popup.style.display = 'none');
    }

    function initializeDefaults() {
      const currentUrl = window.location.href;
      elements.textInput.placeholder = currentUrl;
      elements.resultImage.src = buildImageUrl({
        textInput: currentUrl,
        errorLevel: '15',
        sizeRatio: 80,
        stencil: 'true',
        style: 'square',
        color: '#000000'
      });
      elements.qrText.textContent = currentUrl;
    }

    // Initialize event listeners and defaults
    document.addEventListener('DOMContentLoaded', function () {
      // Form submission
      elements.textForm.addEventListener('submit', handleFormSubmit);
      
      // Save button
      elements.saveButton.addEventListener('click', handleSaveButtonClick);
      
      // Help popups
      const popupMappings = [
        ['textInputLabel', 'textInputHelpPopup'],
        ['errorLevelLabel', 'errorLevelHelpPopup'],
        ['sizeRatioLabel', 'sizeRatioHelpPopup'],
        ['stencilLabel', 'stencilHelpPopup'],
        ['styleLabel', 'styleHelpPopup'],
        ['colorLabel', 'colorHelpPopup']
      ];
      
      popupMappings.forEach(([labelId, popupId]) => addPopupEvents(labelId, popupId));
      
      // Set defaults
      initializeDefaults();
    });
  </script>
</body>

</html>
